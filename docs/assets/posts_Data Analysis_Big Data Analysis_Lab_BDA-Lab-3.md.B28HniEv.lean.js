import{_ as i,c as a,a5 as n,o as t}from"./chunks/framework.CHhwEXkI.js";const c=JSON.parse('{"title":"BDA-Lab-3","description":"","frontmatter":{"date":"2024-11-27T00:00:00.000Z","title":"BDA-Lab-3","status":"DONE","author":["AllenYGY"],"tags":["Lab","Report","CTR"],"publish":true},"headers":[],"relativePath":"posts/Data Analysis/Big Data Analysis/Lab/BDA-Lab-3.md","filePath":"posts/Data Analysis/Big Data Analysis/Lab/BDA-Lab-3.md","lastUpdated":null}'),e={name:"posts/Data Analysis/Big Data Analysis/Lab/BDA-Lab-3.md"};function r(l,s,h,p,o,k){return t(),a("div",null,s[0]||(s[0]=[n(`<h1 id="bda-lab-3" tabindex="-1">BDA-Lab-3 <a class="header-anchor" href="#bda-lab-3" aria-label="Permalink to &quot;BDA-Lab-3&quot;">​</a></h1><h2 id="_1-the-problems-addressed" tabindex="-1">1. The Problems Addressed <a class="header-anchor" href="#_1-the-problems-addressed" aria-label="Permalink to &quot;1. The Problems Addressed&quot;">​</a></h2><h3 id="goal" tabindex="-1">Goal: <a class="header-anchor" href="#goal" aria-label="Permalink to &quot;Goal:&quot;">​</a></h3><p>The goal of this project is to <strong>predict the commercial popularity of characters and plotlines</strong> from <em>Harry Potter and the Sorcerer&#39;s Stone</em>, with a specific focus on <strong>Click-Through Rate (CTR)</strong> estimation. By analyzing the relationships between key characters and key events in the plot, we aim to predict which characters and story arcs will resonate most with audiences in a commercial context. This prediction will help tailor marketing and content promotion strategies, particularly for digital media, by identifying elements that are more likely to engage users.</p><p>The project will involve constructing a <strong>social network</strong> of characters, detecting important relationships and interactions, and applying predictive models to rank these elements according to their potential commercial appeal. Ultimately, the goal is to estimate CTR by identifying the most engaging characters and events that are likely to attract attention and drive user interaction.</p><h3 id="_1-1-background" tabindex="-1">1.1. Background <a class="header-anchor" href="#_1-1-background" aria-label="Permalink to &quot;1.1. Background&quot;">​</a></h3><p>In media commercialization, especially in industries like books, movies, and television, understanding which characters and plotlines resonate with audiences is crucial for <strong>content optimization</strong> and <strong>targeted marketing</strong>. By predicting which aspects of a story will garner the most attention, this project aims to maximize CTR, which directly correlates with audience engagement and, ultimately, the commercial success of content.</p><p>This work builds on the foundations laid in <strong>Lab-1</strong> and <strong>Lab-2</strong>:</p><p>In <strong>Lab-1</strong>, I focused on summarizing the content of <em>The Da Vinci Code</em>, using methods like <strong>word frequency analysis</strong>, <strong>sentiment analysis</strong>, and <strong>content summarization</strong>. These analyses helped extract insights into the book&#39;s structure and its thematic elements.</p><p>In <strong>Lab-2</strong>, the focus shifted to summarizing <em>Harry Potter and the Sorcerer&#39;s Stone</em>, where I condensed the story to highlight the most crucial events and character relationships. This provided the foundation for identifying key interactions that might predict CTR in the commercial context.</p><p>In <strong>Lab-3</strong>, we take these earlier steps further by analyzing <strong>character relationships</strong> and predicting the potential popularity of characters and plot events, ultimately customizing the <strong>CTR</strong> prediction model.</p><h3 id="_1-2-previous-work" tabindex="-1">1.2. Previous Work <a class="header-anchor" href="#_1-2-previous-work" aria-label="Permalink to &quot;1.2. Previous Work&quot;">​</a></h3><h4 id="lab-1-text-summarization-of-the-da-vinci-code" tabindex="-1">Lab-1: Text Summarization of <em>The Da Vinci Code</em> <a class="header-anchor" href="#lab-1-text-summarization-of-the-da-vinci-code" aria-label="Permalink to &quot;Lab-1: Text Summarization of _The Da Vinci Code_&quot;">​</a></h4><p>In <strong>Lab-1</strong>, I aimed to summarize the content of <em>The Da Vinci Code</em> from three perspectives:</p><ol><li><strong>Word Frequency</strong>: Using <strong>NLTK</strong> and <strong>MapReduce</strong>, I processed the text into smaller chunks for easier analysis. I performed a word count to extract the most frequent terms, helping identify key themes and concepts within the book.</li><li><strong>Sentiment Analysis</strong>: I used a pretrained sentiment analysis model to analyze the emotional tone of the text, calculating an <strong>average sentiment score</strong> for the book.</li><li><strong>Content Summary</strong>: By summarizing sections of the text, I used a <strong>Naive Bayes algorithm</strong> and a <strong>pretrained language model</strong> to identify key events and themes in the book.</li></ol><p>These methods provided a deeper understanding of the text’s structure and emotional tone, which contributed to the <strong>character relationship extraction</strong> and <strong>popularity prediction</strong> in <strong>Lab-3</strong>. The sentiment analysis, in particular, offered insight into which parts of the story might elicit emotional responses from audiences—a key factor in predicting <strong>CTR</strong>.</p><h4 id="content-summary" tabindex="-1">Content Summary <a class="header-anchor" href="#content-summary" aria-label="Permalink to &quot;Content Summary&quot;">​</a></h4><p>Divide the book into several parts and use the pretrained model to summary each part. (twice)</p><p><img src="https://cdn.jsdelivr.net/gh/AllenYGY/ImageSpace@main/uPic/IlhXX6.png" alt="Word Cloud"></p><p>Pre-trained models summarize the Da Vinci Code</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>The Da Vinci Code, written by Dan Brown, follows Harvard symbologist Robert Langdon as he becomes entangled in a mysterious murder at the Louvre Museum. Alongside cryptologist Sophie Neveu, Langdon unravels a complex web of codes, symbols, and historical secrets tied to a hidden truth about the Holy Grail and the controversial legacy of Mary Magdalene. The story presents a fictional European secret society, the Priory of Sion, supposedly founded in 1099 and involving famous figures such as Leonardo da Vinci. Another Catholic organization, Opus Dei, emerges in the narrative as a shadowy force, sparking further intrigue. </span></span>
<span class="line"><span></span></span>
<span class="line"><span>The plot unfolds through a series of cryptic messages and objects, including a keystone believed to lead to the Grail’s hidden location. Langdon and Sophie encounter numerous obstacles, including Silas, a devout albino monk, and Leigh Teabing, a Grail historian with his own hidden motives. As they decode symbols like the pentacle and the number PHI, they chase leads through significant historical sites like Westminster Abbey and Rosslyn Chapel. The story weaves themes of faith, power, and historical mystery, ultimately suggesting a hidden lineage of Jesus and Mary Magdalene that could challenge traditional Christian beliefs.</span></span></code></pre></div><h4 id="lab-2-character-and-plot-summarization-of-harry-potter-and-the-sorcerer-s-stone" tabindex="-1">Lab-2: Character and Plot Summarization of <em>Harry Potter and the Sorcerer’s Stone</em> <a class="header-anchor" href="#lab-2-character-and-plot-summarization-of-harry-potter-and-the-sorcerer-s-stone" aria-label="Permalink to &quot;Lab-2: Character and Plot Summarization of _Harry Potter and the Sorcerer’s Stone_&quot;">​</a></h4><p><strong>Lab-2</strong> focused on summarizing <em>Harry Potter and the Sorcerer&#39;s Stone</em>, identifying key events, characters, and their interactions. The summarization process aimed to highlight <strong>important narrative elements</strong> and character dynamics. The goal was to condense the book while retaining the essence of the storyline.</p><p><img src="https://cdn.jsdelivr.net/gh/AllenYGY/ImageSpace@main/uPic/uT1f9K.png" alt="Main Character"></p><p>In <strong>Lab-2</strong>, I used <strong>BERT</strong>, a <strong>pretrained language model</strong>, to generate summaries and understand the structure of the narrative. However, while the summarization helped identify major events, it didn’t provide in-depth analysis of <strong>character relationships</strong>. Recognizing the need to go beyond mere summarization, I turned to more specialized methods in <strong>Lab-3</strong> to focus specifically on <strong>predicting popularity</strong> based on character interactions and plot development.</p><p><img src="https://cdn.jsdelivr.net/gh/AllenYGY/ImageSpace@main/uPic/Character.png" alt="Character"></p><h3 id="_1-3-approach-taken-in-lab-3" tabindex="-1">1.3. Approach Taken in Lab-3 <a class="header-anchor" href="#_1-3-approach-taken-in-lab-3" aria-label="Permalink to &quot;1.3. Approach Taken in Lab-3&quot;">​</a></h3><p><strong>Lab-3</strong> builds on the work done in <strong>Lab-1</strong> and <strong>Lab-2</strong> by using the following approaches:</p><ol><li><p><strong>Character Relationship Extraction</strong>:</p><ul><li>Using <strong>BERT</strong> and <strong>dependency parsing</strong>, I identified key relationships between the characters in <em>Harry Potter and the Sorcerer&#39;s Stone</em>. This was crucial for understanding how characters influence each other and their roles in shaping the plot.</li><li>Relationships were mapped using a knowledge graph, where nodes represent characters and edges represent their interactions.</li></ul></li><li><p><strong>Popularity Prediction</strong>:</p><ul><li>I applied <strong>association mining</strong> and <strong>ranking algorithms</strong> to predict which characters and events would attract the highest <strong>CTR</strong>. This involved analyzing the emotional tones and narrative significance of each character’s role in the plot.</li><li>Character importance was ranked based on their interactions, screen-time, and emotional significance in the narrative.</li></ul></li><li><p><strong>CTR Optimization</strong>:</p><ul><li>Using machine learning models, I predicted which characters and plotlines would generate the most engagement. By focusing on events with high emotional impact or dramatic twists, I ranked these elements for potential <strong>commercial appeal</strong>.</li></ul></li><li><p><strong>Visualization</strong>:</p><ul><li>The character relationships were visualized in the form of a social network graph, which provided a clear representation of the interactions and influence of each character within the story.</li></ul></li></ol><h2 id="_2-main-workflows" tabindex="-1">2. Main Workflows <a class="header-anchor" href="#_2-main-workflows" aria-label="Permalink to &quot;2. Main Workflows&quot;">​</a></h2><h3 id="_2-1-data-preprocessing" tabindex="-1">2.1. Data Preprocessing <a class="header-anchor" href="#_2-1-data-preprocessing" aria-label="Permalink to &quot;2.1. Data Preprocessing&quot;">​</a></h3><p>Building on <strong>Lab-1</strong> and <strong>Lab-2</strong>, the following preprocessing steps were performed:</p><ol><li><strong>Text Chunking</strong>: The content was chunked into smaller parts (as seen in the <code>map</code> function from <strong>Lab-1</strong>) for easier analysis.</li><li><strong>Entity Extraction</strong>: Using Named Entity Recognition (NER), I extracted the names of characters and key plot points from the book.</li><li><strong>Sentiment and Emotional Analysis</strong>: Sentiment scores were applied to each character interaction and key plot event, determining their emotional engagement potential.</li></ol><h3 id="_2-2-relationship-network-construction" tabindex="-1">2.2. Relationship Network Construction <a class="header-anchor" href="#_2-2-relationship-network-construction" aria-label="Permalink to &quot;2.2. Relationship Network Construction&quot;">​</a></h3><p>The relationships between characters were mapped based on their interactions throughout the book. Using a <strong>graph-based representation</strong>, I built a <strong>social network</strong> where:</p><ul><li><strong>Nodes</strong> represent characters.</li><li><strong>Edges</strong> represent interactions or relationships between characters.</li></ul><p>This network provides a visualization of the <strong>social dynamics</strong> within the book, helping identify the most central characters and their roles in the plot.</p><h3 id="_2-3-ctr-prediction-algorithm" tabindex="-1">2.3. CTR Prediction Algorithm <a class="header-anchor" href="#_2-3-ctr-prediction-algorithm" aria-label="Permalink to &quot;2.3. CTR Prediction Algorithm&quot;">​</a></h3><h4 id="feature-engineering" tabindex="-1">Feature Engineering <a class="header-anchor" href="#feature-engineering" aria-label="Permalink to &quot;Feature Engineering&quot;">​</a></h4><p>Based on the results from <strong>Lab-1</strong> and <strong>Lab-2</strong>, I identified the following features to predict CTR:</p><ul><li><strong>Character Centrality</strong>: Characters with more interactions and central roles in the plot are likely to attract higher CTR.</li><li><strong>Plot Importance</strong>: Key plot events that involve multiple central characters are likely to generate higher engagement.</li><li><strong>Sentiment Analysis</strong>: Positive or emotionally charged events are likely to generate higher CTR.</li></ul><h4 id="algorithm-selection" tabindex="-1">Algorithm Selection <a class="header-anchor" href="#algorithm-selection" aria-label="Permalink to &quot;Algorithm Selection&quot;">​</a></h4><p><strong>Experimenting with Different Models for CTR Prediction</strong></p><p>As part of this project, I explored various machine learning models for predicting the <strong>Click-Through Rate (CTR)</strong>, each offering distinct strengths. The models tested include:</p><ol><li><strong>Random Forest Classifier</strong></li><li><strong>XGBoost</strong></li><li><strong>Gradient Boosting</strong></li></ol><p>Each of these models has been trained and evaluated using the same dataset to compare their performance. Below is an overview of the steps taken, the rationale behind choosing each model, and the results obtained.</p><h4 id="random-forest-classifier" tabindex="-1">Random Forest Classifier <a class="header-anchor" href="#random-forest-classifier" aria-label="Permalink to &quot;Random Forest Classifier&quot;">​</a></h4><p>Random Forest is an ensemble learning method that aggregates predictions from multiple decision trees to improve accuracy and reduce overfitting. It is particularly effective when dealing with large datasets and high-dimensional feature spaces, as it helps to capture complex relationships between the features and the target variable.</p><ul><li><strong>Performance</strong>: The Random Forest model showed the best performance among the models tested, achieving an <strong>accuracy</strong> of <strong>0.565</strong> and an <strong>AUC</strong> score of <strong>0.5443</strong>. This suggests that the model was effective at capturing the patterns in the data and produced relatively robust results compared to the other models.</li></ul><h4 id="xgboost" tabindex="-1">XGBoost <a class="header-anchor" href="#xgboost" aria-label="Permalink to &quot;XGBoost&quot;">​</a></h4><p>XGBoost is a gradient boosting algorithm known for its efficiency and performance in structured/tabular data. It builds an ensemble of trees sequentially, where each new tree attempts to correct the errors made by the previous ones. XGBoost is widely used for tasks where predictive performance is critical.</p><ul><li><strong>Performance</strong>: The XGBoost model achieved an <strong>accuracy</strong> of <strong>0.475</strong> and an <strong>AUC</strong> score of <strong>0.4768</strong>. While it showed reasonable performance, the lower accuracy and AUC indicate that XGBoost was less effective in capturing the complexities of the dataset compared to other models.</li></ul><h4 id="gradient-boosting" tabindex="-1">Gradient Boosting <a class="header-anchor" href="#gradient-boosting" aria-label="Permalink to &quot;Gradient Boosting&quot;">​</a></h4><p>Gradient Boosting is another ensemble technique that builds trees sequentially, optimizing for the loss function. Like XGBoost, it focuses on correcting errors made by earlier models, but it can be more sensitive to hyperparameters and the data itself.</p><ul><li><strong>Performance</strong>: The Gradient Boosting model achieved an <strong>accuracy</strong> of <strong>0.555</strong> and an <strong>AUC</strong> score of <strong>0.5573</strong>. While it performed better than XGBoost, it still lagged behind Random Forest, suggesting it might require further tuning to optimize its performance on this dataset.</li></ul><p>Based on the comparative analysis of the models, <strong>Random Forest</strong> was chosen as the final model for CTR prediction. The rationale behind this decision includes:</p><p><strong>Robust Performance</strong>: Random Forest demonstrated the best overall performance, with the highest accuracy and AUC score. This indicates that it was able to capture the underlying patterns in the data most effectively. <strong>Reduced Overfitting</strong>: As an ensemble method, Random Forest helps mitigate overfitting, which can be a common issue with individual decision trees. This makes it more reliable in producing accurate predictions on unseen data. <strong>Interpretability and Flexibility</strong>: While Random Forest may not be as interpretable as simpler models, it provides an effective balance between model complexity and prediction accuracy. It also handles high-dimensional datasets well, which is critical in CTR prediction tasks where the feature space can be large and complex.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pandas </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pd</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> numpy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sklearn.model_selection </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> train_test_split</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sklearn.metrics </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> accuracy_score, roc_auc_score</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sklearn.ensemble </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RandomForestClassifier</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sklearn.metrics </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> accuracy_score, roc_auc_score, roc_curve</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> matplotlib.pyplot </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> plt</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> xgboost </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> xgb</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sklearn.ensemble </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GradientBoostingClassifier</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ctr_prediction_RandomForest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Function to predict Click-Through Rate (CTR) using a machine learning model.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Parameters:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - data: pandas DataFrame, where the last column is &#39;CTR&#39; (target variable).</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Returns:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - model: trained model.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - accuracy: model&#39;s accuracy score.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - auc: ROC-AUC score.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - y_pred: Predicted CTR values.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Preprocessing steps (same as before)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.isnull().sum().any():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.dropna()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    categorical_cols </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user_location&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ad_type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Example categorical columns</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pd.get_dummies(data, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">columns</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">categorical_cols, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">drop_first</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    X </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.drop(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">columns</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;CTR&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Features</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;CTR&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Target variable: CTR (0 = No Click, 1 = Click)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Train-Test Split</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    X_train, X_test, y_train, y_test </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> train_test_split(X, y, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">test_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">random_state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Initialize and train the model (e.g., Random Forest, Logistic Regression, etc.)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RandomForestClassifier(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">random_state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model.fit(X_train, y_train)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Make predictions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    y_pred </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model.predict(X_test)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Evaluate performance</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    accuracy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> accuracy_score(y_test, y_pred)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    auc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> roc_auc_score(y_test, model.predict_proba(X_test)[:, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Step 9: Plotting Model Performance (Optional)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Plot ROC curve</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fpr, tpr, thresholds </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> roc_curve(y_test, model.predict_proba(X_test)[:, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    plt.figure(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">figsize</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    plt.plot(fpr, tpr, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;blue&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">label</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ROC Curve&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    plt.plot([</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;gray&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">linestyle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;--&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    plt.xlabel(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;False Positive Rate&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    plt.ylabel(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;True Positive Rate&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    plt.title(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ROC Curve&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    plt.legend(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">loc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;lower right&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    plt.show()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model, accuracy, auc, y_pred</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ctr_prediction_xgboost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Function to predict Click-Through Rate (CTR) using XGBoost Classifier.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Parameters:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - data: pandas DataFrame, where the last column is &#39;CTR&#39; (target variable).</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Returns:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - model: trained XGBoost model.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - accuracy: model&#39;s accuracy score.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - auc: ROC-AUC score.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - y_pred: Predicted CTR values.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Preprocessing steps (same as before)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.isnull().sum().any():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.dropna()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    categorical_cols </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user_location&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ad_type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pd.get_dummies(data, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">columns</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">categorical_cols, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">drop_first</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    X </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.drop(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">columns</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;CTR&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Features</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;CTR&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Target variable: CTR (0 = No Click, 1 = Click)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Train-Test Split</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    X_train, X_test, y_train, y_test </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> train_test_split(X, y, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">test_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">random_state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Initialize and train the XGBoost Classifier</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> xgb.XGBClassifier(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">use_label_encoder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">random_state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model.fit(X_train, y_train)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Make predictions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    y_pred </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model.predict(X_test)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Evaluate performance</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    accuracy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> accuracy_score(y_test, y_pred)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    auc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> roc_auc_score(y_test, y_pred)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model, accuracy, auc, y_pred</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ctr_prediction_gradient_boosting</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Function to predict Click-Through Rate (CTR) using Gradient Boosting Classifier.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Parameters:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - data: pandas DataFrame, where the last column is &#39;CTR&#39; (target variable).</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Returns:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - model: trained Gradient Boosting model.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - accuracy: model&#39;s accuracy score.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - auc: ROC-AUC score.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - y_pred: Predicted CTR values.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Preprocessing steps (same as before)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.isnull().sum().any():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.dropna()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    categorical_cols </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user_location&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ad_type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pd.get_dummies(data, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">columns</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">categorical_cols, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">drop_first</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    X </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.drop(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">columns</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;CTR&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Features</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;CTR&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Target variable: CTR (0 = No Click, 1 = Click)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Train-Test Split</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    X_train, X_test, y_train, y_test </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> train_test_split(X, y, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">test_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">random_state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Initialize and train the Gradient Boosting Classifier</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GradientBoostingClassifier(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">random_state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model.fit(X_train, y_train)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Make predictions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    y_pred </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model.predict(X_test)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Evaluate performance</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    accuracy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> accuracy_score(y_test, y_pred)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    auc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> roc_auc_score(y_test, y_pred)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model, accuracy, auc, y_pred</span></span></code></pre></div><h3 id="_2-4-evaluation-and-justification" tabindex="-1">2.4. Evaluation and Justification <a class="header-anchor" href="#_2-4-evaluation-and-justification" aria-label="Permalink to &quot;2.4. Evaluation and Justification&quot;">​</a></h3><h4 id="evaluation-metrics" tabindex="-1">Evaluation Metrics <a class="header-anchor" href="#evaluation-metrics" aria-label="Permalink to &quot;Evaluation Metrics&quot;">​</a></h4><p>The following metrics were used to evaluate the performance of the CTR model:</p><ul><li><strong>Accuracy</strong>: The proportion of correct CTR predictions (high vs. low).</li><li><strong>Precision and Recall</strong>: These metrics were used to evaluate the model’s ability to predict high CTR events correctly.</li><li><strong>F1 Score</strong>: The harmonic mean of precision and recall, providing a balanced evaluation.</li></ul><h4 id="justification" tabindex="-1">Justification <a class="header-anchor" href="#justification" aria-label="Permalink to &quot;Justification&quot;">​</a></h4><ul><li><strong>Character Centrality</strong>: Characters like Harry Potter and Dumbledore, who have more interactions and influence in the plot, are predicted to have higher CTR.</li><li><strong>Plot Importance</strong>: Major events involving these central characters (e.g., Harry’s confrontation with Voldemort) have higher CTR due to their significance in the narrative.</li></ul><h3 id="_2-5-discussion" tabindex="-1">2.5. Discussion <a class="header-anchor" href="#_2-5-discussion" aria-label="Permalink to &quot;2.5. Discussion&quot;">​</a></h3><p>By analyzing <strong>Lab-1</strong> and <strong>Lab-2</strong>, we were able to build a robust <strong>CTR estimation model</strong> for <em>Harry Potter and the Sorcerer’s Stone</em>. This model helps predict which characters and plot points will engage audiences the most in a commercialized context. The insights gained can be applied to <strong>marketing campaigns</strong>, <strong>content distribution</strong>, and <strong>audience engagement strategies</strong> for book adaptations and media properties.</p><h2 id="_3-results" tabindex="-1">3. Results <a class="header-anchor" href="#_3-results" aria-label="Permalink to &quot;3. Results&quot;">​</a></h2><h3 id="_3-1-character-relationship-network" tabindex="-1">3.1. Character Relationship Network <a class="header-anchor" href="#_3-1-character-relationship-network" aria-label="Permalink to &quot;3.1. Character Relationship Network&quot;">​</a></h3><p>The character network was successfully visualized, revealing the key figures and their centrality in the story. Characters like <strong>Harry Potter</strong>, <strong>Hermione Granger</strong>, and <strong>Ron Weasley</strong> were found to have high centrality, while others like <strong>Draco Malfoy</strong> and <strong>Voldemort</strong> played more peripheral, yet pivotal, roles.</p><p><img src="https://cdn.jsdelivr.net/gh/AllenYGY/ImageSpace@main/uPic/3chsG1.png" alt="Knowledge Graph"></p><h3 id="_3-2-ctr-prediction-accuracy" tabindex="-1">3.2. CTR Prediction Accuracy <a class="header-anchor" href="#_3-2-ctr-prediction-accuracy" aria-label="Permalink to &quot;3.2. CTR Prediction Accuracy&quot;">​</a></h3><p>The CTR prediction model showed promising results, with key plot events like <strong>Harry&#39;s victory over Quirrell</strong> and <strong>the reveal of Voldemort’s return</strong> generating the highest predicted CTRs. Characters like <strong>Dumbledore</strong> and <strong>Hermione</strong> were also found to have high predicted popularity, with potential for high audience engagement.</p><h3 id="_3-3-visualizing-ctr-results" tabindex="-1">3.3. Visualizing CTR Results <a class="header-anchor" href="#_3-3-visualizing-ctr-results" aria-label="Permalink to &quot;3.3. Visualizing CTR Results&quot;">​</a></h3><p><img src="https://cdn.jsdelivr.net/gh/AllenYGY/ImageSpace@main/uPic/e8OCzL.png" alt="e8OCzL"></p><p>The visualization of predicted CTR scores confirmed that certain characters and events would likely attract significant attention, offering insights into how the book’s commercial appeal could be optimized.</p><h2 id="_4-conclusion" tabindex="-1">4. Conclusion <a class="header-anchor" href="#_4-conclusion" aria-label="Permalink to &quot;4. Conclusion&quot;">​</a></h2><p><strong>Lab-3</strong> successfully extended the work from <strong>Lab-1</strong> and <strong>Lab-2</strong> to predict the popularity of characters and events in <em>Harry Potter and the Sorcerer’s Stone</em> after commercialization. By analyzing character relationships and applying machine learning techniques for CTR prediction, this project provides valuable insights into how to optimize audience engagement based on narrative dynamics.</p><p>The <strong>CTR prediction model</strong> not only helps identify key characters but also provides a framework for analyzing the commercial potential of plot events, which could be applied to similar works in the future.</p>`,78)]))}const g=i(e,[["render",r]]);export{c as __pageData,g as default};
